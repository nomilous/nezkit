// Generated by CoffeeScript 1.4.0
var support;

module.exports = support = {
  fn2modules: function(fn) {
    var arg, chain, funcStr, module, modules, narg, nestings, ref, targetArg, _i, _j, _len, _len1, _ref, _ref1;
    modules = [];
    funcStr = fn.toString();
    _ref = fn.fing.args;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      arg = _ref[_i];
      module = arg.name;
      if (module.match(/^_arg/)) {
        nestings = {};
        _ref1 = funcStr.match(/_(arg|ref)\.(\w*)/g);
        for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
          narg = _ref1[_j];
          chain = narg.split('.');
          ref = chain.shift();
          if (ref === '_arg') {
            targetArg = funcStr.match(new RegExp("(\\w*) = _arg." + chain[0]))[1];
            if (chain[chain.length - 1] !== targetArg) {
              chain.push(targetArg);
            }
          }
          nestings[targetArg] = chain;
        }
        modules.push({
          _nested: nestings
        });
      } else {
        modules.push({
          module: arg.name
        });
      }
    }
    return modules;
  }
};
